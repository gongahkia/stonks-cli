# ============================================================================
# STONKS-CLI ENHANCEMENT TODO
# Phase 1: Fast Mode + Charts (ship first)
# Phase 2: Lightweight TUI
# Phase 3: Fundamental Data (free sources)
# Phase 4: Portfolio Tracking
# Phase 5: Alerts System
# Phase 6: Incremental Niche Features
# ============================================================================

# ----------------------------------------------------------------------------
# PHASE 4B: PORTFOLIO COMMANDS
# ----------------------------------------------------------------------------








Add `stonks portfolio history` command that reads from portfolio_history.jsonl (append-only log of all add/remove transactions) and displays transaction history
Create function `log_transaction(action: str, ticker: str, shares: float, price: float, gain_loss: float = None)` in storage.py that appends JSON line to portfolio_history.jsonl with timestamp

# ----------------------------------------------------------------------------
# PHASE 4C: PAPER TRADING
# ----------------------------------------------------------------------------

Create new module `src/stonks_cli/portfolio/paper.py` with function `init_paper_portfolio(starting_cash: float = 10000.0) -> Portfolio` that creates new Portfolio with specified cash balance and empty positions, saved to paper_portfolio.json
Add `stonks paper init` command with `--cash <AMOUNT>` flag (default 10000) that initializes paper trading portfolio
Add `stonks paper buy <TICKER> <SHARES>` command that checks paper portfolio has sufficient cash, fetches current price, deducts cost from cash_balance, adds Position, and confirms trade with "Bought 10 AAPL @ $182.50 ($1825.00 total). Cash remaining: $8175.00"
Add `stonks paper sell <TICKER> <SHARES>` command that checks position exists with sufficient shares, fetches current price, adds proceeds to cash_balance, removes/reduces Position, and displays realized gain/loss
Add `stonks paper status` command that displays paper portfolio summary: cash balance, positions table with current values, total portfolio value, and overall P&L since inception (comparing to initial cash)
Create function `calculate_paper_performance(portfolio: Portfolio, initial_cash: float) -> dict` in paper.py returning total_value, total_return_pct, best_trade, worst_trade, win_rate from transaction history
Add `stonks paper reset` command with confirmation prompt that deletes paper_portfolio.json and paper_history.jsonl to start fresh
Add `stonks paper leaderboard` command that reads paper trading history and displays performance metrics: total return %, Sharpe ratio approximation, max drawdown, number of trades, win rate

# ----------------------------------------------------------------------------
# PHASE 5A: ALERT CONFIGURATION
# ----------------------------------------------------------------------------

Create new module `src/stonks_cli/alerts/models.py` with dataclass `Alert` containing fields: id (uuid), ticker, condition_type (price_above/price_below/rsi_above/rsi_below/sma_cross_up/sma_cross_down), threshold (float), created_at, triggered_at (optional), enabled (bool)
Create new module `src/stonks_cli/alerts/storage.py` with function `get_alerts_path() -> Path` returning platform-appropriate path to alerts.json
Create function `load_alerts() -> list[Alert]` in storage.py that reads and deserializes alerts.json
Create function `save_alert(alert: Alert) -> None` in storage.py that appends alert to alerts.json
Create function `delete_alert(alert_id: str) -> bool` in storage.py that removes alert by ID and returns success status
Add `stonks alert add <TICKER> price-above <VALUE>` command that creates Alert with condition_type=price_above and saves, confirming with "Alert created: AAPL price above $200.00 (ID: abc123)"
Add `stonks alert add <TICKER> price-below <VALUE>` command for price_below condition
Add `stonks alert add <TICKER> rsi-above <VALUE>` command for RSI threshold alerts (e.g., overbought at 70)
Add `stonks alert add <TICKER> rsi-below <VALUE>` command for RSI threshold alerts (e.g., oversold at 30)
Add `stonks alert list` command that displays all alerts as Rich table with columns: ID (truncated), Ticker, Condition, Threshold, Status (enabled/triggered), Created
Add `stonks alert remove <ALERT_ID>` command that deletes alert and confirms removal
Add `stonks alert disable <ALERT_ID>` and `stonks alert enable <ALERT_ID>` commands to toggle alert enabled status without deleting

# ----------------------------------------------------------------------------
# PHASE 5B: ALERT CHECKING & NOTIFICATION
# ----------------------------------------------------------------------------

Create new module `src/stonks_cli/alerts/checker.py` with function `check_alert(alert: Alert, df: pd.DataFrame) -> bool` that evaluates alert condition against latest data, returning True if condition is met
Implement condition evaluation in check_alert: price_above/below compares latest close to threshold, rsi_above/below computes 14-period RSI and compares to threshold
Create function `check_all_alerts() -> list[tuple[Alert, bool]]` in checker.py that loads all enabled alerts, fetches required data (batched by ticker), checks each alert, and returns list of (alert, triggered) tuples
Create function `notify_terminal_bell(alert: Alert) -> None` in new module `src/stonks_cli/alerts/notify.py` that prints alert message to stdout with Rich formatting and sends terminal bell character (\a)
Create function `log_alert_trigger(alert: Alert) -> None` in notify.py that appends triggered alert to alerts_log.jsonl with timestamp
Create function `notify_webhook(alert: Alert, webhook_url: str) -> bool` in notify.py that POSTs JSON payload {ticker, condition, threshold, triggered_at, message} to configured webhook URL, returning success status
Add `webhook_url` field to config.py AppConfig for alert webhook delivery (optional, None by default)
Add `stonks alert check` command that runs check_all_alerts(), displays triggered alerts, sends notifications (bell + webhook if configured), and marks alerts as triggered
Integrate alert checking into existing scheduler: add alert check step after analysis in scheduled runs, calling check_all_alerts and notify functions

# ----------------------------------------------------------------------------
# PHASE 5C: CONDITION-BASED ALERTS (ADVANCED)
# ----------------------------------------------------------------------------

Add `stonks alert add <TICKER> golden-cross` command that creates alert for 50-day SMA crossing above 200-day SMA
Add `stonks alert add <TICKER> death-cross` command that creates alert for 50-day SMA crossing below 200-day SMA
Implement SMA cross detection in check_alert: compute both SMAs, check if fast SMA crossed slow SMA by comparing current and previous day relationship
Add `stonks alert add <TICKER> volume-spike <MULTIPLIER>` command that triggers when daily volume exceeds N times the 20-day average volume (default 2x)
Implement volume spike detection in check_alert: compute 20-day volume SMA, compare latest volume to threshold multiple
Add `stonks alert add <TICKER> earnings-soon <DAYS>` command that triggers when ticker's next earnings date is within N days
Implement earnings alert in check_alert by calling fetch_ticker_earnings_history and comparing next earnings date to current date
Add `stonks alert add <TICKER> new-high-52w` command that triggers when price exceeds 52-week high
Add `stonks alert add <TICKER> new-low-52w` command that triggers when price falls below 52-week low
Implement 52-week high/low detection in check_alert using rolling 252-day max/min of close prices

# ----------------------------------------------------------------------------
# PHASE 6: INCREMENTAL NICHE FEATURES
# ----------------------------------------------------------------------------

Create function `fetch_dividend_info(ticker: str) -> dict` in new module `src/stonks_cli/data/dividends.py` that extracts from yfinance: dividend_yield, annual_dividend, payout_ratio, ex_dividend_date, next_dividend_date, dividend_history (last 8 quarters)
Add `stonks dividend <TICKER>` command that displays dividend information as Rich panel: current yield, annual payment, payout ratio, ex-date countdown, and table of recent dividend history with payment dates and amounts
Add `stonks dividend calendar` command that scans configured watchlist tickers and displays upcoming ex-dividend dates for the next 30 days
Create function `compute_earnings_implied_move(ticker: str) -> float` in earnings.py that calculates average absolute post-earnings move from historical data
Add `--implied-move` flag to `stonks earnings --ticker <TICKER>` that displays the historically implied earnings move percentage
Add `stonks movers` command that fetches daily performance of major indices (SPY, QQQ, DIA, IWM) and displays as compact table with daily change percentages
Add `--sector` flag to `stonks movers` that shows sector ETF performance instead of indices (XLK, XLV, XLF, XLE, XLY, XLP, XLI, XLB, XLU, XLRE, XLC)
Create function `detect_unusual_volume(tickers: list[str], threshold: float = 2.0) -> list[dict]` in new module `src/stonks_cli/analysis/unusual.py` that identifies tickers with volume > threshold * 20-day average
Add `stonks unusual` command that scans watchlist for unusual volume activity and displays flagged tickers with volume multiple and price change
